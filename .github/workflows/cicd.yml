name: mern github cicd

on: push

jobs:
    build: 
        runs-on: ubuntu-latest
        steps:
            - uses:  actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                node-version: 20
             # Install backend dependencies
            - name: Install Backend Dependencies
              working-directory: ./backend
              run: npm install
              env:
                  CI: true

            # Install frontend dependencies
            - name: Install Frontend Dependencies
              working-directory: ./frontend
              run: npm install
              env:
                  CI: true


    deploy:
        runs-on: ubuntu-latest
        needs: [build]
        steps:
            - uses: JorgeLNJunior/render-deploy@v1.4.5
              with:
                api_key: ${{secrets.RENDER_API_KEY}}
                service_id: ${{ secrets.RENDER_SERVICE_ID }}
    
    frontend_deploy:
          runs-on: ubuntu-latest
          steps:
             - uses: actions/checkout@v2 
             - uses: amondnet/vercel-action@v25
               with:
                    vercel-token: ${{ secrets.VERCEL_TOKEN }}
                    vercel-org-id: ${{ secrets.ORG_ID}}  
                    vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID}} 
                    working-directory: ./frontend